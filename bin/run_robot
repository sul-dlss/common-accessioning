#!/usr/bin/env ruby
# Will run one robot as specified 
# Should be run from the root of the robot project
# Assumes there's a ROBOT_ROOT/.rvmrc file that will load the correct ruby version and gemset, if necessary
# robot_root$ ruby ./bin/run_robot accessionWF publish
# 
# With Options
# Options must be placed BEFORE workflow and robot name
# robot_root$ ruby ./bin/run_robot --druid druid:12345 accessionWF publish
#
# From cron
# * * * * bash --login -c 'cd /path/to/robot_root && ruby./bin/run_robot.rb accessionWF publish' > /home/deploy/crondebug.log 2>&1

require File.expand_path(File.dirname(__FILE__) + '/../config/boot')

action = ARGV.shift
robots = []
while ARGV.first =~ /:/
  robots << ARGV.shift.split(/:/)
end
controller = LyberCore::Robots::ServiceController.new(:log_level => Logger::INFO, 
  :working_dir => File.expand_path(File.join(File.dirname(__FILE__), "..")), :argv => ARGV)

case action
when 'start'
  robots.each { |robot| controller.start(*robot) }
when 'stop'
  robots.each { |robot| controller.stop(*robot) }
when 'status'
  robots.each { |robot| puts controller.status_message(*robot) }
end
